{% extends 'base.html.twig' %}

{% block title %}VAT Calculator{% endblock %}

{% block body %}
<div class="min-h-screen bg-gray-50 flex flex-col items-center py-10">
    <div class="w-full max-w-6xl grid grid-cols-1 md:grid-cols-2 gap-8">
        
        <!-- Left Column: Calculator -->
        <div class="bg-white rounded-2xl shadow p-8">
            <h1 class="text-2xl font-bold text-gray-800 mb-6">VAT Calculator</h1>

            <form method="get" action="{{ path('app_vat') }}" class="space-y-4">
                <div>
                    <label for="price" class="block text-sm font-medium text-gray-700">Price (without VAT)</label>
                    <input type="number" step="0.01" name="price" id="price" required
                           class="mt-1 block w-full rounded-lg border-gray-300 shadow-sm focus:ring-blue-500 focus:border-blue-500 sm:text-sm p-2">
                </div>

                <div>
                    <label for="rate" class="block text-sm font-medium text-gray-700">VAT Rate (%)</label>
                    <input type="number" step="0.1" name="rate" id="rate" required
                           class="mt-1 block w-full rounded-lg border-gray-300 shadow-sm focus:ring-blue-500 focus:border-blue-500 sm:text-sm p-2">
                </div>

                <button type="submit"
                        class="w-full bg-blue-600 text-white py-2 px-4 rounded-lg shadow hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-blue-500">
                    Calculate
                </button>
            </form>

            {% if result %}
                <div class="mt-8 bg-green-50 border border-green-200 rounded-lg p-4">
                    <h2 class="text-lg font-semibold text-green-700 mb-2">Result</h2>
                    <p class="text-gray-700">Price: <span class="font-medium">{{ result.price|format_currency('GBP') }}</span></p>
                    <p class="text-gray-700">VAT ({{ result.rate }}%): <span class="font-medium">{{ result.vat|format_currency('GBP') }}</span></p>
                    <p class="text-gray-900 font-bold text-lg">Total: {{ result.total|format_currency('GBP') }}</p>
                </div>
            {% endif %}
        </div>

        <!-- Right Column: Last 5 History -->
        {% if history %}
            <div class="bg-white rounded-2xl shadow p-8">
                <h2 class="text-xl font-semibold text-gray-800 mb-4">History (last 5 calculations)</h2>
                <div class="overflow-x-auto">
                    <table class="min-w-full border border-gray-200 rounded-lg">
                        <thead class="bg-gray-100">
                            <tr>
                                <th class="px-4 py-2 text-left text-sm font-medium text-gray-600">Date</th>
                                <th class="px-4 py-2 text-left text-sm font-medium text-gray-600">Price</th>
                                <th class="px-4 py-2 text-left text-sm font-medium text-gray-600">Rate</th>
                                <th class="px-4 py-2 text-left text-sm font-medium text-gray-600">VAT</th>
                                <th class="px-4 py-2 text-left text-sm font-medium text-gray-600">Total</th>
                            </tr>
                        </thead>
                        <tbody class="divide-y divide-gray-200">
                            {% for calc in history %}
                                <tr>
                                    <td class="px-4 py-2 text-sm text-gray-700">{{ calc.createdAt|date('Y-m-d H:i') }}</td>
                                    <td class="px-4 py-2 text-sm text-gray-700">{{ calc.price|format_currency('GBP') }}</td>
                                    <td class="px-4 py-2 text-sm text-gray-700">{{ calc.rate }}%</td>
                                    <td class="px-4 py-2 text-sm text-gray-700">{{ calc.vat|format_currency('GBP') }}</td>
                                    <td class="px-4 py-2 font-semibold text-gray-900">{{ calc.total|format_currency('GBP') }}</td>
                                </tr>
                            {% endfor %}
                        </tbody>
                    </table>
                </div>
                <div class="mt-4 text-right">
                    <a href="{{ path('app_vat_history') }}" class="text-blue-600 hover:underline text-sm">View full history â†’</a>
                </div>
            </div>
        {% endif %}
    </div>
</div>
{% endblock %}
